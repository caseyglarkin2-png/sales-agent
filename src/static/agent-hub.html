<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Hub ‚Ä¢ CaseyOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
        }

        .card-hover {
            transition: all 0.2s;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.3);
        }

        .domain-sales {
            border-left-color: #3b82f6;
        }

        .domain-content {
            border-left-color: #10b981;
        }

        .domain-fulfillment {
            border-left-color: #f59e0b;
        }

        .domain-contracts {
            border-left-color: #8b5cf6;
        }

        .domain-ops {
            border-left-color: #ef4444;
        }

        .domain-research {
            border-left-color: #06b6d4;
        }

        .capability-tag {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.15s;
        }

        .capability-tag:hover {
            background: rgba(99, 102, 241, 0.2);
        }

        .approval-badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .agent-card.approved {
            border-color: #10b981;
        }

        .chat-bubble {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            border-radius: 1rem 1rem 1rem 0;
        }

        .chat-bubble-user {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem 1rem 0 1rem;
        }
    </style>
</head>

<body class="gradient-bg min-h-screen text-white">
    <!-- Header -->
    <header class="border-b border-white/10 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="/caseyos" class="text-white/60 hover:text-white">‚Üê CaseyOS</a>
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <span class="text-3xl">ü§ñ</span> Agent Hub
                </h1>
            </div>
            <div class="flex items-center gap-4">
                <div id="health-status" class="flex items-center gap-2 px-3 py-1 rounded-full bg-white/10">
                    <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                    <span class="text-sm">Connecting...</span>
                </div>
                <button onclick="openJarvisChat()"
                    class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-medium transition flex items-center gap-2">
                    <span>üí¨</span> Ask Jarvis
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <div class="text-3xl font-bold" id="stat-total-agents">-</div>
                <div class="text-sm text-white/60">Total Agents</div>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <div class="text-3xl font-bold text-green-400" id="stat-approved">-</div>
                <div class="text-sm text-white/60">Approved</div>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <div class="text-3xl font-bold" id="stat-domains">-</div>
                <div class="text-sm text-white/60">Domains</div>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <div class="text-3xl font-bold" id="stat-capabilities">-</div>
                <div class="text-sm text-white/60">Capabilities</div>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <div class="text-3xl font-bold text-blue-400" id="stat-executions">-</div>
                <div class="text-sm text-white/60">Today's Executions</div>
            </div>
        </div>

        <!-- Domain Filter -->
        <div class="flex flex-wrap gap-2 mb-6">
            <button onclick="filterDomain('all')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/20 font-medium transition hover:bg-white/30"
                data-domain="all">
                All Agents
            </button>
            <button onclick="filterDomain('sales')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="sales">
                üéØ Sales
            </button>
            <button onclick="filterDomain('content')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="content">
                üìù Content
            </button>
            <button onclick="filterDomain('fulfillment')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="fulfillment">
                üì¶ Fulfillment
            </button>
            <button onclick="filterDomain('contracts')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="contracts">
                üìÑ Contracts
            </button>
            <button onclick="filterDomain('ops')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="ops">
                ‚öôÔ∏è Ops
            </button>
            <button onclick="filterDomain('research')"
                class="domain-btn px-4 py-2 rounded-lg bg-white/10 font-medium transition hover:bg-white/20"
                data-domain="research">
                üîç Research
            </button>
        </div>

        <!-- Quick Actions Bar -->
        <div class="bg-white/5 rounded-xl p-4 border border-white/10 mb-8">
            <h3 class="text-sm font-medium text-white/60 mb-3">Quick Actions</h3>
            <div class="flex flex-wrap gap-2">
                <button onclick="quickAction('draft_email')"
                    class="px-4 py-2 bg-blue-600/30 hover:bg-blue-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚úâÔ∏è Draft Email
                </button>
                <button onclick="quickAction('schedule_meeting')"
                    class="px-4 py-2 bg-green-600/30 hover:bg-green-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    üìÖ Schedule Meeting
                </button>
                <button onclick="quickAction('create_proposal')"
                    class="px-4 py-2 bg-purple-600/30 hover:bg-purple-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    üìã Create Proposal
                </button>
                <button onclick="quickAction('research_company')"
                    class="px-4 py-2 bg-cyan-600/30 hover:bg-cyan-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    üîç Research Company
                </button>
                <button onclick="quickAction('score_lead')"
                    class="px-4 py-2 bg-amber-600/30 hover:bg-amber-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚≠ê Score Lead
                </button>
                <button onclick="quickAction('repurpose_content')"
                    class="px-4 py-2 bg-pink-600/30 hover:bg-pink-600/50 rounded-lg text-sm font-medium transition flex items-center gap-2">
                    ‚ôªÔ∏è Repurpose Content
                </button>
            </div>
        </div>

        <!-- Agents Grid -->
        <div id="agents-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Loading state -->
            <div class="col-span-full text-center py-12 text-white/60">
                <div
                    class="animate-spin inline-block w-8 h-8 border-4 border-white/20 border-t-white rounded-full mb-4">
                </div>
                <p>Loading agents...</p>
            </div>
        </div>
    </main>

    <!-- Jarvis Chat Sidebar -->
    <div id="jarvis-chat"
        class="fixed right-0 top-0 h-full w-96 bg-slate-900 border-l border-white/10 transform translate-x-full transition-transform duration-300 z-50 flex flex-col">
        <div class="p-4 border-b border-white/10 flex items-center justify-between">
            <h2 class="text-lg font-bold flex items-center gap-2">
                <span class="text-2xl">ü§ñ</span> Ask Jarvis
            </h2>
            <button onclick="closeJarvisChat()" class="text-white/60 hover:text-white text-2xl">&times;</button>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
            <div class="chat-bubble p-4 text-sm max-w-[80%]">
                <p><strong>Hey Casey!</strong> üëã</p>
                <p class="mt-2">I'm Jarvis, your GTM command center. Ask me anything:</p>
                <ul class="mt-2 space-y-1 text-white/90">
                    <li>‚Ä¢ "Draft a follow-up for John at Acme"</li>
                    <li>‚Ä¢ "What's our pipeline health?"</li>
                    <li>‚Ä¢ "Create a proposal for TechCorp"</li>
                    <li>‚Ä¢ "Score this lead"</li>
                </ul>
            </div>
        </div>

        <div class="p-4 border-t border-white/10">
            <form id="chat-form" onsubmit="sendMessage(event)" class="flex gap-2">
                <input type="text" id="chat-input" placeholder="Ask Jarvis anything..."
                    class="flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <button type="submit"
                    class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-medium transition">
                    Send
                </button>
            </form>
        </div>
    </div>

    <!-- Agent Detail Modal -->
    <div id="agent-modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="bg-slate-900 rounded-2xl border border-white/10 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-white/10 flex items-center justify-between">
                <h2 id="modal-agent-name" class="text-xl font-bold">Agent Name</h2>
                <button onclick="closeAgentModal()" class="text-white/60 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="modal-content" class="p-6">
                <!-- Filled dynamically -->
            </div>
        </div>
    </div>

    <!-- Quick Action Modal -->
    <div id="quick-action-modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="bg-slate-900 rounded-2xl border border-white/10 max-w-lg w-full">
            <div class="p-6 border-b border-white/10 flex items-center justify-between">
                <h2 id="quick-action-title" class="text-xl font-bold">Quick Action</h2>
                <button onclick="closeQuickActionModal()"
                    class="text-white/60 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="quick-action-content" class="p-6">
                <!-- Filled dynamically -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';
        let agents = {};
        let approvals = {};
        let currentDomain = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadAgents();
            await loadApprovals();
            await checkHealth();
        });

        // Load agents from API
        async function loadAgents() {
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/agents`);
                const data = await res.json();
                agents = data.agents || {};

                // Update stats
                document.getElementById('stat-total-agents').textContent = data.total || 0;
                document.getElementById('stat-domains').textContent = data.domains?.length || 0;

                // Count capabilities
                let capCount = 0;
                Object.values(agents).forEach(a => capCount += (a.capabilities?.length || 0));
                document.getElementById('stat-capabilities').textContent = capCount;

                renderAgents();
            } catch (e) {
                console.error('Failed to load agents:', e);
                document.getElementById('agents-grid').innerHTML = `
                    <div class="col-span-full text-center py-12 text-red-400">
                        <p>Failed to load agents. Make sure Jarvis API is running.</p>
                        <button onclick="loadAgents()" class="mt-4 px-4 py-2 bg-white/10 rounded-lg">Retry</button>
                    </div>
                `;
            }
        }

        // Load approvals
        async function loadApprovals() {
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/approvals`);
                const data = await res.json();
                approvals = {};
                (data.approvals || []).forEach(a => {
                    approvals[`${a.agent}:${a.action}`] = a;
                });
                document.getElementById('stat-approved').textContent = data.total || 0;
                renderAgents();
            } catch (e) {
                console.error('Failed to load approvals:', e);
            }
        }

        // Check health
        async function checkHealth() {
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/health`);
                const data = await res.json();
                const el = document.getElementById('health-status');
                if (data.status === 'healthy') {
                    el.innerHTML = `
                        <span class="w-2 h-2 rounded-full bg-green-400"></span>
                        <span class="text-sm">${data.agent_count} agents ready</span>
                    `;
                } else {
                    el.innerHTML = `
                        <span class="w-2 h-2 rounded-full bg-red-400"></span>
                        <span class="text-sm">Unhealthy</span>
                    `;
                }
            } catch (e) {
                document.getElementById('health-status').innerHTML = `
                    <span class="w-2 h-2 rounded-full bg-red-400"></span>
                    <span class="text-sm">Offline</span>
                `;
            }
        }

        // Render agents grid
        function renderAgents() {
            const grid = document.getElementById('agents-grid');
            const filtered = Object.entries(agents).filter(([name, info]) => {
                if (currentDomain === 'all') return true;
                return info.domain === currentDomain;
            });

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12 text-white/60">
                        <p>No agents found for this domain.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(([name, info]) => {
                const isApproved = info.capabilities?.some(cap => approvals[`${name}:${cap}`]);
                const domainClass = `domain-${info.domain}`;

                return `
                    <div class="agent-card bg-white/5 rounded-xl p-5 border-l-4 ${domainClass} border border-white/10 card-hover cursor-pointer ${isApproved ? 'approved' : ''}"
                         onclick="openAgentModal('${name}')">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <h3 class="font-bold text-lg">${formatAgentName(name)}</h3>
                                <span class="text-xs px-2 py-0.5 rounded-full bg-white/10 text-white/60">${info.domain}</span>
                            </div>
                            ${isApproved ? '<span class="approval-badge text-green-400 text-xs">‚úì Approved</span>' : ''}
                        </div>
                        <p class="text-sm text-white/70 mb-3">${info.description || 'No description'}</p>
                        <div class="flex flex-wrap gap-1">
                            ${(info.capabilities || []).slice(0, 3).map(cap => `
                                <span class="capability-tag text-xs px-2 py-1 rounded">${cap}</span>
                            `).join('')}
                            ${(info.capabilities?.length || 0) > 3 ? `<span class="text-xs text-white/40">+${info.capabilities.length - 3} more</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Format agent name for display
        function formatAgentName(name) {
            return name.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        }

        // Filter by domain
        function filterDomain(domain) {
            currentDomain = domain;

            // Update button styles
            document.querySelectorAll('.domain-btn').forEach(btn => {
                if (btn.dataset.domain === domain) {
                    btn.classList.remove('bg-white/10');
                    btn.classList.add('bg-white/20');
                } else {
                    btn.classList.remove('bg-white/20');
                    btn.classList.add('bg-white/10');
                }
            });

            renderAgents();
        }

        // Open agent modal
        function openAgentModal(agentName) {
            const info = agents[agentName];
            if (!info) return;

            document.getElementById('modal-agent-name').textContent = formatAgentName(agentName);
            document.getElementById('modal-content').innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h4 class="text-sm font-medium text-white/60 mb-2">Description</h4>
                        <p>${info.description || 'No description available.'}</p>
                    </div>
                    
                    <div>
                        <h4 class="text-sm font-medium text-white/60 mb-2">Domain</h4>
                        <span class="px-3 py-1 rounded-full bg-white/10">${info.domain}</span>
                    </div>
                    
                    <div>
                        <h4 class="text-sm font-medium text-white/60 mb-2">Capabilities</h4>
                        <div class="space-y-2">
                            ${(info.capabilities || []).map(cap => {
                const key = `${agentName}:${cap}`;
                const isApproved = approvals[key];
                return `
                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                        <div>
                                            <span class="font-medium">${cap}</span>
                                            ${isApproved ? '<span class="ml-2 text-xs text-green-400">‚úì Approved</span>' : ''}
                                        </div>
                                        <div class="flex gap-2">
                                            ${!isApproved ? `
                                                <button onclick="approveCapability('${agentName}', '${cap}')" 
                                                        class="px-3 py-1 bg-green-600/30 hover:bg-green-600/50 rounded text-sm transition">
                                                    Approve
                                                </button>
                                            ` : `
                                                <button onclick="revokeCapability('${agentName}', '${cap}')" 
                                                        class="px-3 py-1 bg-red-600/30 hover:bg-red-600/50 rounded text-sm transition">
                                                    Revoke
                                                </button>
                                            `}
                                            <button onclick="testCapability('${agentName}', '${cap}')" 
                                                    class="px-3 py-1 bg-blue-600/30 hover:bg-blue-600/50 rounded text-sm transition">
                                                Test
                                            </button>
                                        </div>
                                    </div>
                                `;
            }).join('')}
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t border-white/10">
                        <button onclick="testAgent('${agentName}')" 
                                class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-medium transition">
                            üß™ Test Agent in Playground
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('agent-modal').classList.remove('hidden');
        }

        function closeAgentModal() {
            document.getElementById('agent-modal').classList.add('hidden');
        }

        // Approve capability
        async function approveCapability(agent, action) {
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/agents/${agent}/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agent, action, scope: 'session' })
                });
                if (res.ok) {
                    await loadApprovals();
                    openAgentModal(agent); // Refresh modal
                    showToast('Capability approved!', 'success');
                }
            } catch (e) {
                showToast('Failed to approve', 'error');
            }
        }

        // Revoke capability
        async function revokeCapability(agent, action) {
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/agents/${agent}/approve/${action}`, {
                    method: 'DELETE'
                });
                if (res.ok) {
                    await loadApprovals();
                    openAgentModal(agent);
                    showToast('Approval revoked', 'success');
                }
            } catch (e) {
                showToast('Failed to revoke', 'error');
            }
        }

        // Test capability
        async function testCapability(agent, action) {
            showToast(`Testing ${agent}:${action}...`, 'info');
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ agent, action, context: {}, dry_run: true })
                });
                const data = await res.json();
                console.log('Test result:', data);
                showToast('Test complete! Check console.', 'success');
            } catch (e) {
                showToast('Test failed', 'error');
            }
        }

        // Test agent in playground
        function testAgent(agentName) {
            closeAgentModal();
            openJarvisChat();
            document.getElementById('chat-input').value = `Test the ${formatAgentName(agentName)} agent`;
            document.getElementById('chat-input').focus();
        }

        // Quick actions
        function quickAction(actionType) {
            const configs = {
                'draft_email': { title: 'Draft Email', fields: ['email', 'purpose'] },
                'schedule_meeting': { title: 'Schedule Meeting', fields: ['email', 'duration'] },
                'create_proposal': { title: 'Create Proposal', fields: ['company', 'deal_value'] },
                'research_company': { title: 'Research Company', fields: ['domain'] },
                'score_lead': { title: 'Score Lead', fields: ['email', 'company'] },
                'repurpose_content': { title: 'Repurpose Content', fields: ['content_url'] }
            };

            const config = configs[actionType];
            if (!config) return;

            document.getElementById('quick-action-title').textContent = config.title;
            document.getElementById('quick-action-content').innerHTML = `
                <form onsubmit="executeQuickAction(event, '${actionType}')" class="space-y-4">
                    ${config.fields.map(field => `
                        <div>
                            <label class="block text-sm font-medium text-white/60 mb-1">${formatAgentName(field)}</label>
                            <input type="text" name="${field}" required
                                   class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    `).join('')}
                    <div class="flex gap-2 pt-4">
                        <button type="button" onclick="closeQuickActionModal()" class="flex-1 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition">
                            Cancel
                        </button>
                        <button type="submit" class="flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg font-medium transition">
                            Execute
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('quick-action-modal').classList.remove('hidden');
        }

        async function executeQuickAction(e, actionType) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const target = Object.fromEntries(formData);

            closeQuickActionModal();
            showToast('Executing...', 'info');

            try {
                const res = await fetch(`${API_BASE}/api/jarvis/quick-action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action_type: actionType, target, options: {} })
                });
                const data = await res.json();
                console.log('Quick action result:', data);
                showToast('Action completed!', 'success');
            } catch (e) {
                showToast('Action failed', 'error');
            }
        }

        function closeQuickActionModal() {
            document.getElementById('quick-action-modal').classList.add('hidden');
        }

        // Jarvis chat
        function openJarvisChat() {
            document.getElementById('jarvis-chat').classList.remove('translate-x-full');
        }

        function closeJarvisChat() {
            document.getElementById('jarvis-chat').classList.add('translate-x-full');
        }

        async function sendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const query = input.value.trim();
            if (!query) return;

            // Add user message
            const messagesEl = document.getElementById('chat-messages');
            messagesEl.innerHTML += `
                <div class="chat-bubble-user p-3 text-sm max-w-[80%] ml-auto">${query}</div>
            `;
            input.value = '';
            messagesEl.scrollTop = messagesEl.scrollHeight;

            // Call Jarvis
            try {
                const res = await fetch(`${API_BASE}/api/jarvis/ask`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await res.json();

                // Format response
                let responseHtml = '';
                if (data.status === 'success') {
                    const agentsList = data.agents_invoked?.join(', ') || 'none';
                    responseHtml = `
                        <p class="font-medium mb-2">Here's what I found:</p>
                        <p class="text-sm text-white/80 mb-2">Agents consulted: ${agentsList}</p>
                        <pre class="text-xs bg-black/30 p-2 rounded overflow-x-auto">${JSON.stringify(data.results, null, 2)}</pre>
                    `;
                } else {
                    responseHtml = `<p>${data.message || 'I couldn\'t process that request.'}</p>`;
                }

                messagesEl.innerHTML += `
                    <div class="chat-bubble p-4 text-sm max-w-[80%]">${responseHtml}</div>
                `;
                messagesEl.scrollTop = messagesEl.scrollHeight;
            } catch (e) {
                messagesEl.innerHTML += `
                    <div class="chat-bubble p-4 text-sm max-w-[80%] bg-red-600/50">
                        <p>Sorry, I couldn't connect to the server.</p>
                    </div>
                `;
            }
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                info: 'bg-blue-600'
            };

            const toast = document.createElement('div');
            toast.className = `fixed bottom-4 right-4 px-6 py-3 ${colors[type]} rounded-lg shadow-xl z-50 animate-pulse`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>

</html>